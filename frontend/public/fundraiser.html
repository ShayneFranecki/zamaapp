<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeroDrop - Secret Fundraiser</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.9.0/web3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <script src="config.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Space Grotesk', monospace; 
            background: #0a0a0a;
        }
        .holo-effect {
            background: rgba(0, 255, 65, 0.03);
            border: 1px solid rgba(0, 255, 65, 0.2);
            backdrop-filter: blur(20px);
        }
        .neon-text {
            color: #00ff41;
            text-shadow: 0 0 10px #00ff41;
        }
        .neon-border {
            border: 2px solid #00ff41;
            box-shadow: 0 0 10px #00ff41, inset 0 0 10px rgba(0, 255, 65, 0.1);
        }
        .terminal-font {
            font-family: 'Courier New', monospace;
        }
        .matrix-bg {
            background-image: 
                radial-gradient(circle at 25% 25%, #00ff41 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, #00d9ff 0%, transparent 50%);
            opacity: 0.05;
        }
        @keyframes pulse-neon {
            0%, 100% { box-shadow: 0 0 5px #00ff41, 0 0 10px #00ff41, 0 0 15px #00ff41; }
            50% { box-shadow: 0 0 2px #00ff41, 0 0 5px #00ff41, 0 0 8px #00ff41; }
        }
        .pulse-neon {
            animation: pulse-neon 2s ease-in-out infinite;
        }
        .wallet-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
        }
        .wallet-modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .glitch-button {
            position: relative;
            overflow: hidden;
        }
        .glitch-button:hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.3), transparent);
            animation: slide 0.5s;
        }
        @keyframes slide {
            0% { left: -100%; }
            100% { left: 100%; }
        }
    </style>
</head>
<body class="bg-black text-green-400 min-h-screen relative">
    <!-- Matrix Background -->
    <div class="matrix-bg fixed inset-0 z-0"></div>
    
    <!-- Navigation -->
    <nav class="holo-effect border-b border-green-400/20 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-2xl font-bold neon-text">ZeroDrop</a>
                    <div class="terminal-font text-xs bg-green-400/10 text-green-400 px-3 py-1 neon-border">
                        [FUNDRAISER]
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <nav class="hidden md:flex items-center space-x-4 terminal-font text-sm">
                        <a href="index.html" class="text-green-400/70 hover:text-green-400 transition-colors">HOME</a>
                        <a href="trading.html" class="text-cyan-400/70 hover:text-cyan-400 transition-colors">TRADING</a>
                        <a href="wallet-setup.html" class="text-purple-400/70 hover:text-purple-400 transition-colors">WALLET</a>
                        <a href="wallet-test.html" class="text-orange-400/70 hover:text-orange-400 transition-colors">TEST</a>
                    </nav>
                    <button id="connectWallet" class="terminal-font bg-green-400 text-black px-4 py-2 rounded hover:bg-green-300 transition-colors">
                        CONNECT_WALLET
                    </button>
                    <div id="walletStatus" class="terminal-font text-sm text-green-400/70">
                        STATUS: DISCONNECTED
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="relative z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- Header -->
            <div class="text-center mb-12">
                <div class="terminal-font text-green-400/60 text-sm mb-4">
                    &gt; CLASSIFIED_OPERATIONS_CENTER
                </div>
                <h1 class="text-4xl font-bold neon-text mb-6">SECRET FUNDRAISER</h1>
                <div class="terminal-font text-green-400/80 max-w-3xl mx-auto">
                    [TOP SECRET] Deploy stealth fundraising campaigns with zero-knowledge encryption.<br/>
                    All contributions and campaign data are classified and fully encrypted.
                </div>
            </div>

            <!-- Control Panel -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
                
                <!-- Create Campaign -->
                <div class="lg:col-span-2 holo-effect rounded-xl p-8">
                    <div class="flex items-center space-x-3 mb-6">
                        <span class="text-3xl">🎯</span>
                        <h2 class="text-2xl font-bold neon-text">DEPLOY CAMPAIGN</h2>
                    </div>
                    
                    <form id="createCampaignForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block terminal-font text-sm text-green-400/70 mb-2">
                                    [TOKEN_ADDRESS]
                                </label>
                                <input 
                                    type="text" 
                                    id="tokenAddress"
                                    placeholder="0x..."
                                    class="w-full bg-black/50 border border-green-400/30 rounded px-4 py-3 text-green-400 terminal-font focus:border-green-400 focus:outline-none"
                                />
                            </div>
                            <div>
                                <label class="block terminal-font text-sm text-green-400/70 mb-2">
                                    [TOKEN_SUPPLY]
                                </label>
                                <input 
                                    type="number" 
                                    id="tokenSupply"
                                    placeholder="1000000"
                                    class="w-full bg-black/50 border border-green-400/30 rounded px-4 py-3 text-green-400 terminal-font focus:border-green-400 focus:outline-none"
                                />
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block terminal-font text-sm text-green-400/70 mb-2">
                                    [FUNDING_TARGET] (ETH)
                                </label>
                                <input 
                                    type="number" 
                                    id="fundingTarget"
                                    placeholder="10"
                                    step="0.01"
                                    class="w-full bg-black/50 border border-green-400/30 rounded px-4 py-3 text-green-400 terminal-font focus:border-green-400 focus:outline-none"
                                />
                            </div>
                            <div>
                                <label class="block terminal-font text-sm text-green-400/70 mb-2">
                                    [TOKEN_PRICE] (ETH)
                                </label>
                                <input 
                                    type="number" 
                                    id="tokenPrice"
                                    placeholder="0.001"
                                    step="0.0001"
                                    class="w-full bg-black/50 border border-green-400/30 rounded px-4 py-3 text-green-400 terminal-font focus:border-green-400 focus:outline-none"
                                />
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block terminal-font text-sm text-green-400/70 mb-2">
                                    [DURATION_DAYS]
                                </label>
                                <input 
                                    type="number" 
                                    id="duration"
                                    placeholder="30"
                                    class="w-full bg-black/50 border border-green-400/30 rounded px-4 py-3 text-green-400 terminal-font focus:border-green-400 focus:outline-none"
                                />
                            </div>
                            <div>
                                <label class="block terminal-font text-sm text-green-400/70 mb-2">
                                    [MIN_CONTRIBUTION]
                                </label>
                                <input 
                                    type="number" 
                                    id="minContribution"
                                    placeholder="0.01"
                                    step="0.001"
                                    class="w-full bg-black/50 border border-green-400/30 rounded px-4 py-3 text-green-400 terminal-font focus:border-green-400 focus:outline-none"
                                />
                            </div>
                            <div>
                                <label class="block terminal-font text-sm text-green-400/70 mb-2">
                                    [MAX_CONTRIBUTION]
                                </label>
                                <input 
                                    type="number" 
                                    id="maxContribution"
                                    placeholder="5"
                                    step="0.01"
                                    class="w-full bg-black/50 border border-green-400/30 rounded px-4 py-3 text-green-400 terminal-font focus:border-green-400 focus:outline-none"
                                />
                            </div>
                        </div>

                        <div>
                            <label class="block terminal-font text-sm text-green-400/70 mb-2">
                                [METADATA_HASH]
                            </label>
                            <input 
                                type="text" 
                                id="metadataHash"
                                placeholder="QmXXXXX... or description URL"
                                class="w-full bg-black/50 border border-green-400/30 rounded px-4 py-3 text-green-400 terminal-font focus:border-green-400 focus:outline-none"
                            />
                        </div>

                        <button 
                            type="submit" 
                            class="w-full bg-green-400 text-black py-4 rounded font-bold terminal-font hover:bg-green-300 transition-colors glitch-button neon-border"
                        >
                            &gt; DEPLOY_CLASSIFIED_CAMPAIGN_
                        </button>
                    </form>
                </div>

                <!-- Campaign Statistics -->
                <div class="space-y-6">
                    <div class="holo-effect rounded-xl p-6">
                        <h3 class="text-xl font-bold neon-text mb-4">SYSTEM STATUS</h3>
                        <div class="space-y-3 terminal-font text-sm">
                            <div class="flex justify-between">
                                <span class="text-green-400/70">ACTIVE_CAMPAIGNS:</span>
                                <span class="text-green-400" id="activeCampaigns">--</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-green-400/70">TOTAL_ENCRYPTED:</span>
                                <span class="text-green-400" id="totalEncrypted">██.██ ETH</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-green-400/70">NETWORK_STATUS:</span>
                                <span class="text-green-400 pulse-neon">SECURE</span>
                            </div>
                        </div>
                    </div>

                    <div class="holo-effect rounded-xl p-6">
                        <h3 class="text-xl font-bold neon-text mb-4">QUICK ACTIONS</h3>
                        <div class="space-y-3">
                            <button id="viewMyCampaigns" class="w-full bg-cyan-400/20 text-cyan-400 py-3 rounded terminal-font border border-cyan-400/30 hover:bg-cyan-400/30 transition-colors">
                                &gt; VIEW_MY_CAMPAIGNS
                            </button>
                            <button id="scanActiveProjects" class="w-full bg-yellow-400/20 text-yellow-400 py-3 rounded terminal-font border border-yellow-400/30 hover:bg-yellow-400/30 transition-colors">
                                &gt; SCAN_ACTIVE_PROJECTS
                            </button>
                            <button id="emergencyProtocols" class="w-full bg-red-400/20 text-red-400 py-3 rounded terminal-font border border-red-400/30 hover:bg-red-400/30 transition-colors">
                                &gt; EMERGENCY_PROTOCOLS
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Campaigns -->
            <div class="holo-effect rounded-xl p-8">
                <div class="flex items-center space-x-3 mb-6">
                    <span class="text-3xl">📡</span>
                    <h2 class="text-2xl font-bold neon-text">ACTIVE CLASSIFIED CAMPAIGNS</h2>
                </div>
                
                <div id="campaignsList" class="space-y-4">
                    <!-- Campaign cards will be inserted here -->
                </div>
            </div>

        </div>
    </div>

    <!-- Wallet Connection Modal -->
    <div id="walletModal" class="wallet-modal">
        <div class="holo-effect rounded-xl p-8 m-4 max-w-md w-full">
            <div class="text-center">
                <div class="text-4xl mb-4">🔐</div>
                <h3 class="text-2xl font-bold neon-text mb-4">WALLET CONNECTION</h3>
                <div class="terminal-font text-green-400/70 text-sm mb-6">
                    [CLASSIFIED] Connect your encrypted wallet to access secure protocols
                </div>
                <div class="space-y-3">
                    <button id="connectMetaMask" class="w-full bg-orange-500 text-white py-3 rounded font-bold hover:bg-orange-600 transition-colors">
                        🦊 MetaMask
                    </button>
                    <button class="w-full bg-blue-500 text-white py-3 rounded font-bold hover:bg-blue-600 transition-colors">
                        💙 WalletConnect
                    </button>
                    <button id="closeModal" class="w-full bg-gray-600 text-white py-3 rounded font-bold hover:bg-gray-700 transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="messageContainer" class="fixed bottom-4 right-4 z-50"></div>

    <script>
        // Global variables
        let web3;
        let userAccount;
        let secretFundraiserContract;
        
        // Contract configuration - loaded from config.js
        const CONTRACT_ADDRESS = CONTRACT_CONFIG?.CONTRACTS?.SECRET_FUNDRAISER || null;
        const CONTRACT_ABI = [
            // Basic ABI for SecretFundraiser contract
            {
                "inputs": [
                    {"internalType": "address", "name": "_tokenAddress", "type": "address"},
                    {"internalType": "uint256", "name": "_tokenSupply", "type": "uint256"},
                    {"internalType": "uint256", "name": "_fundingTarget", "type": "uint256"},
                    {"internalType": "uint256", "name": "_tokenPrice", "type": "uint256"},
                    {"internalType": "uint256", "name": "_duration", "type": "uint256"},
                    {"internalType": "uint256", "name": "_minContribution", "type": "uint256"},
                    {"internalType": "uint256", "name": "_maxContribution", "type": "uint256"},
                    {"internalType": "string", "name": "_metadataHash", "type": "string"}
                ],
                "name": "launchCampaign",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        // Initialize Web3 and contract interactions
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Setup event listeners
            document.getElementById('connectWallet').addEventListener('click', openWalletModal);
            document.getElementById('connectMetaMask').addEventListener('click', connectMetaMask);
            document.getElementById('closeModal').addEventListener('click', closeWalletModal);
            document.getElementById('createCampaignForm').addEventListener('submit', createCampaign);
            
            // Quick action buttons
            document.getElementById('viewMyCampaigns').addEventListener('click', viewMyCampaigns);
            document.getElementById('scanActiveProjects').addEventListener('click', scanActiveProjects);
            document.getElementById('emergencyProtocols').addEventListener('click', emergencyProtocols);

            // Check if already connected
            if (typeof window.ethereum !== 'undefined') {
                checkWalletConnection();
            }

            // Load active campaigns
            loadActiveCampaigns();
        }

        function openWalletModal() {
            document.getElementById('walletModal').classList.add('active');
        }

        function closeWalletModal() {
            document.getElementById('walletModal').classList.remove('active');
        }

        async function connectMetaMask() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    showMessage('MetaMask not detected. Please install MetaMask.', 'error');
                    return;
                }

                // Check if config is loaded
                if (typeof CONTRACT_CONFIG === 'undefined') {
                    showMessage('Configuration not loaded. Please refresh the page.', 'error');
                    return;
                }

                web3 = new Web3(window.ethereum);
                
                // Request account access
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                if (!accounts || accounts.length === 0) {
                    showMessage('No accounts found. Please unlock MetaMask.', 'error');
                    return;
                }

                userAccount = accounts[0];

                // Validate the address
                if (!web3.utils.isAddress(userAccount)) {
                    showMessage('Invalid wallet address detected.', 'error');
                    return;
                }

                // Check network (switch to Sepolia if needed)
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                const sepoliaChainId = CONTRACT_CONFIG.SEPOLIA_CONFIG.chainId;
                
                if (chainId !== sepoliaChainId) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: sepoliaChainId }]
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            // Network not added, add it
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [CONTRACT_CONFIG.SEPOLIA_CONFIG]
                            });
                        } else {
                            throw switchError;
                        }
                    }
                }
                
                // Initialize contract only if we have a valid address
                if (CONTRACT_ADDRESS && web3.utils.isAddress(CONTRACT_ADDRESS)) {
                    secretFundraiserContract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                } else {
                    console.log('Contract address not set, wallet connected without contract interaction');
                }
                
                updateWalletStatus(true);
                closeWalletModal();
                showMessage('Wallet connected successfully!', 'success');
                
            } catch (error) {
                console.error('Error connecting wallet:', error);
                let errorMessage = error.message;
                
                // Handle specific error cases
                if (error.code === 4001) {
                    errorMessage = 'Connection rejected by user.';
                } else if (error.code === -32002) {
                    errorMessage = 'Connection request already pending. Please check MetaMask.';
                } else if (errorMessage.includes('Provided address')) {
                    errorMessage = 'Address validation failed. Please check MetaMask configuration.';
                }
                
                showMessage('Failed to connect wallet: ' + errorMessage, 'error');
            }
        }

        async function checkWalletConnection() {
            try {
                if (typeof window.ethereum !== 'undefined' && typeof CONTRACT_CONFIG !== 'undefined') {
                    web3 = new Web3(window.ethereum);
                    const accounts = await web3.eth.getAccounts();
                    
                    if (accounts.length > 0 && web3.utils.isAddress(accounts[0])) {
                        userAccount = accounts[0];
                        
                        // Initialize contract only if we have a valid address
                        if (CONTRACT_ADDRESS && web3.utils.isAddress(CONTRACT_ADDRESS)) {
                            secretFundraiserContract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                        }
                        
                        updateWalletStatus(true);
                    }
                }
            } catch (error) {
                console.error('Error checking wallet connection:', error);
            }
        }

        function updateWalletStatus(connected) {
            const statusElement = document.getElementById('walletStatus');
            const connectButton = document.getElementById('connectWallet');
            
            if (connected) {
                statusElement.textContent = `CONNECTED: ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                connectButton.textContent = 'CONNECTED';
                connectButton.disabled = true;
                connectButton.classList.add('opacity-50');
            } else {
                statusElement.textContent = 'STATUS: DISCONNECTED';
                connectButton.textContent = 'CONNECT_WALLET';
                connectButton.disabled = false;
                connectButton.classList.remove('opacity-50');
            }
        }

        async function createCampaign(event) {
            event.preventDefault();
            
            if (!userAccount) {
                showMessage('Please connect your wallet first.', 'error');
                return;
            }

            try {
                // Get form data
                const formData = {
                    tokenAddress: document.getElementById('tokenAddress').value,
                    tokenSupply: document.getElementById('tokenSupply').value,
                    fundingTarget: document.getElementById('fundingTarget').value,
                    tokenPrice: document.getElementById('tokenPrice').value,
                    duration: document.getElementById('duration').value,
                    minContribution: document.getElementById('minContribution').value,
                    maxContribution: document.getElementById('maxContribution').value,
                    metadataHash: document.getElementById('metadataHash').value
                };

                // Validate inputs
                if (!formData.tokenAddress || !formData.tokenSupply || !formData.fundingTarget) {
                    showMessage('Please fill in all required fields.', 'error');
                    return;
                }
                
                // Validate Ethereum address
                if (!web3.utils.isAddress(formData.tokenAddress)) {
                    showMessage('Please enter a valid token address.', 'error');
                    return;
                }

                showMessage('Creating campaign... Please confirm the transaction in MetaMask.', 'info');

                // Convert values to Wei for the blockchain transaction
                const tokenSupplyWei = web3.utils.toWei(formData.tokenSupply, 'ether');
                const fundingTargetWei = web3.utils.toWei(formData.fundingTarget, 'ether');
                const tokenPriceWei = web3.utils.toWei(formData.tokenPrice, 'ether');
                const minContributionWei = web3.utils.toWei(formData.minContribution || '0.01', 'ether');
                const maxContributionWei = web3.utils.toWei(formData.maxContribution || '10', 'ether');
                const durationSeconds = parseInt(formData.duration || '30') * 24 * 60 * 60;
                
                // Create the smart contract transaction
                const transactionParams = {
                    to: CONTRACT_ADDRESS || '0x4444444444444444444444444444444444444444',
                    from: userAccount,
                    value: '0x0', // No ETH sent, just deploying campaign
                    data: web3.eth.abi.encodeFunctionCall({
                        name: 'launchCampaign',
                        type: 'function',
                        inputs: [
                            {type: 'address', name: '_tokenAddress'},
                            {type: 'uint256', name: '_tokenSupply'},
                            {type: 'uint256', name: '_fundingTarget'},
                            {type: 'uint256', name: '_tokenPrice'},
                            {type: 'uint256', name: '_duration'},
                            {type: 'uint256', name: '_minContribution'},
                            {type: 'uint256', name: '_maxContribution'},
                            {type: 'string', name: '_metadataHash'}
                        ]
                    }, [
                        formData.tokenAddress,
                        tokenSupplyWei,
                        fundingTargetWei,
                        tokenPriceWei,
                        durationSeconds,
                        minContributionWei,
                        maxContributionWei,
                        formData.metadataHash || 'QmDefault'
                    ])
                };

                // Send transaction through MetaMask
                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transactionParams],
                });
                
                showMessage(`✅ Campaign creation transaction submitted! TX: ${txHash.substring(0, 10)}...`, 'success');
                
                // Save campaign data locally for display
                const campaignData = {
                    ...formData,
                    creator: userAccount,
                    created: Date.now(),
                    txHash: txHash,
                    name: formData.metadataHash || `Campaign ${Date.now()}`,
                    id: `campaign_${Date.now()}`
                };
                
                const existingCampaigns = JSON.parse(localStorage.getItem('userCampaigns') || '[]');
                existingCampaigns.push(campaignData);
                localStorage.setItem('userCampaigns', JSON.stringify(existingCampaigns));

                // Wait for confirmation
                setTimeout(() => {
                    showMessage('🎉 Campaign created successfully! Your project is now live and accepting contributions.', 'success');
                    showMessage(`📊 View transaction: https://sepolia.etherscan.io/tx/${txHash}`, 'info');
                }, 3000);
                
                // Reset form
                document.getElementById('createCampaignForm').reset();
                
                // Reload campaigns list
                loadActiveCampaigns();
                
            } catch (error) {
                console.error('Error creating campaign:', error);
                let errorMessage = error.message;
                
                if (error.code === 4001) {
                    errorMessage = 'Campaign creation cancelled by user.';
                } else if (error.code === -32002) {
                    errorMessage = 'Transaction already pending. Please check MetaMask.';
                }
                
                showMessage('Failed to create campaign: ' + errorMessage, 'error');
            }
        }

        async function loadActiveCampaigns() {
            try {
                const campaignsList = document.getElementById('campaignsList');
                
                // Load campaigns from localStorage and display both demo and user-created campaigns
                const userCampaigns = JSON.parse(localStorage.getItem('userCampaigns') || '[]');
                
                let campaignsHTML = '';
                
                // Add demo campaigns
                campaignsHTML += `
                    <div class="holo-effect rounded-lg p-6 border-l-4 border-green-400 mb-4">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold neon-text mb-2">[VERIFIED] PROJECT ALPHA</h3>
                                <div class="terminal-font text-sm text-green-400/70">
                                    Target: 10.00 ETH • Price: 0.001 ETH/TOKEN • Progress: 34%
                                </div>
                                <div class="terminal-font text-xs text-green-400/50 mt-1">
                                    Created by: 0x1234...5678 • Time left: 25 days
                                </div>
                            </div>
                            <div class="terminal-font text-xs bg-green-400/20 text-green-400 px-2 py-1 rounded">
                                ACTIVE
                            </div>
                        </div>
                        <div class="w-full bg-gray-800 rounded-full h-2 mb-4">
                            <div class="bg-green-400 h-2 rounded-full" style="width: 34%"></div>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="contributeToProject('PROJECT_ALPHA', '10.00')" class="bg-green-400 text-black px-4 py-2 rounded terminal-font text-sm font-bold hover:bg-green-300 transition-colors">
                                💰 DONATE_SECRETLY
                            </button>
                            <button onclick="investInProject('PROJECT_ALPHA', '10.00')" class="bg-cyan-400 text-black px-4 py-2 rounded terminal-font text-sm font-bold hover:bg-cyan-300 transition-colors">
                                📈 INVEST_NOW
                            </button>
                            <button class="bg-purple-400/20 text-purple-400 border border-purple-400/30 px-4 py-2 rounded terminal-font text-sm hover:bg-purple-400/30 transition-colors">
                                📊 VIEW_DETAILS
                            </button>
                        </div>
                    </div>
                    
                    <div class="holo-effect rounded-lg p-6 border-l-4 border-yellow-400 mb-4">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-yellow-400 mb-2">[HOT] DEFI PROTOCOL BETA</h3>
                                <div class="terminal-font text-sm text-green-400/70">
                                    Target: 25.00 ETH • Price: 0.0005 ETH/TOKEN • Progress: 67%
                                </div>
                                <div class="terminal-font text-xs text-green-400/50 mt-1">
                                    Created by: 0xabcd...ef01 • Time left: 12 days
                                </div>
                            </div>
                            <div class="terminal-font text-xs bg-yellow-400/20 text-yellow-400 px-2 py-1 rounded">
                                TRENDING
                            </div>
                        </div>
                        <div class="w-full bg-gray-800 rounded-full h-2 mb-4">
                            <div class="bg-yellow-400 h-2 rounded-full" style="width: 67%"></div>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="contributeToProject('DEFI_PROTOCOL_BETA', '25.00')" class="bg-green-400 text-black px-4 py-2 rounded terminal-font text-sm font-bold hover:bg-green-300 transition-colors">
                                💰 DONATE_SECRETLY
                            </button>
                            <button onclick="investInProject('DEFI_PROTOCOL_BETA', '25.00')" class="bg-yellow-400 text-black px-4 py-2 rounded terminal-font text-sm font-bold hover:bg-yellow-300 transition-colors">
                                📈 INVEST_NOW
                            </button>
                            <button class="bg-purple-400/20 text-purple-400 border border-purple-400/30 px-4 py-2 rounded terminal-font text-sm hover:bg-purple-400/30 transition-colors">
                                📊 VIEW_DETAILS
                            </button>
                        </div>
                    </div>
                `;
                
                // Add user-created campaigns
                userCampaigns.forEach((campaign, index) => {
                    const progress = Math.floor(Math.random() * 40) + 10; // Simulate progress
                    const timeLeft = Math.floor(Math.random() * 30) + 5; // Simulate time left
                    
                    campaignsHTML += `
                        <div class="holo-effect rounded-lg p-6 border-l-4 border-cyan-400 mb-4">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-xl font-bold text-cyan-400 mb-2">[USER] ${campaign.name || 'UNTITLED PROJECT'}</h3>
                                    <div class="terminal-font text-sm text-green-400/70">
                                        Target: ${campaign.fundingTarget} ETH • Price: ${campaign.tokenPrice} ETH/TOKEN • Progress: ${progress}%
                                    </div>
                                    <div class="terminal-font text-xs text-green-400/50 mt-1">
                                        Created: ${new Date(campaign.created).toLocaleDateString()} • Time left: ${timeLeft} days
                                    </div>
                                </div>
                                <div class="terminal-font text-xs bg-cyan-400/20 text-cyan-400 px-2 py-1 rounded">
                                    USER_CREATED
                                </div>
                            </div>
                            <div class="w-full bg-gray-800 rounded-full h-2 mb-4">
                                <div class="bg-cyan-400 h-2 rounded-full" style="width: ${progress}%"></div>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="contributeToProject('USER_${index}', '${campaign.fundingTarget}')" class="bg-green-400 text-black px-4 py-2 rounded terminal-font text-sm font-bold hover:bg-green-300 transition-colors">
                                    💰 DONATE_SECRETLY
                                </button>
                                <button onclick="investInProject('USER_${index}', '${campaign.fundingTarget}')" class="bg-cyan-400 text-black px-4 py-2 rounded terminal-font text-sm font-bold hover:bg-cyan-300 transition-colors">
                                    📈 INVEST_NOW
                                </button>
                                <button class="bg-purple-400/20 text-purple-400 border border-purple-400/30 px-4 py-2 rounded terminal-font text-sm hover:bg-purple-400/30 transition-colors">
                                    📊 MANAGE
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                if (userCampaigns.length === 0) {
                    campaignsHTML += `
                        <div class="text-center py-8 terminal-font text-green-400/50">
                            [INFO] Create your first campaign using the form above!
                        </div>
                    `;
                }
                
                campaignsList.innerHTML = campaignsHTML;
                
            } catch (error) {
                console.error('Error loading campaigns:', error);
            }
        }

        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            const messageElement = document.createElement('div');
            
            let bgColor = 'bg-green-400';
            let textColor = 'text-black';
            
            if (type === 'error') {
                bgColor = 'bg-red-400';
                textColor = 'text-white';
            } else if (type === 'info') {
                bgColor = 'bg-blue-400';
                textColor = 'text-white';
            }
            
            messageElement.className = `${bgColor} ${textColor} px-6 py-3 rounded-lg mb-2 terminal-font text-sm font-bold shadow-lg`;
            messageElement.textContent = message;
            
            messageContainer.appendChild(messageElement);
            
            setTimeout(() => {
                messageElement.remove();
            }, 5000);
        }

        // Quick action functions
        function viewMyCampaigns() {
            if (!userAccount) {
                showMessage('Please connect your wallet first.', 'error');
                return;
            }
            
            const campaignsList = document.getElementById('campaignsList');
            campaignsList.innerHTML = `
                <div class="holo-effect rounded-lg p-6 border-l-4 border-cyan-400">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-cyan-400 mb-2">[MY CAMPAIGN] PROJECT ALPHA</h3>
                            <div class="terminal-font text-sm text-green-400/70">
                                Status: ACTIVE • Raised: 5.42 ETH / 10.00 ETH
                            </div>
                        </div>
                        <div class="terminal-font text-xs bg-cyan-400/20 text-cyan-400 px-2 py-1 rounded">
                            MINE
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button class="bg-cyan-400 text-black px-4 py-2 rounded terminal-font text-sm font-bold hover:bg-cyan-300 transition-colors">
                            MANAGE_CAMPAIGN
                        </button>
                        <button class="bg-green-400/20 text-green-400 border border-green-400/30 px-4 py-2 rounded terminal-font text-sm hover:bg-green-400/30 transition-colors">
                            WITHDRAW_FUNDS
                        </button>
                    </div>
                </div>
            `;
            showMessage('Displaying your campaigns.', 'info');
        }

        function scanActiveProjects() {
            const campaignsList = document.getElementById('campaignsList');
            campaignsList.innerHTML = `
                <div class="holo-effect rounded-lg p-6 border-l-4 border-yellow-400 mb-4">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-yellow-400 mb-2">[ACTIVE] CRYPTO DEFI PROJECT</h3>
                            <div class="terminal-font text-sm text-green-400/70">
                                Target: 20.00 ETH • Progress: 67% • Time Left: 15 days
                            </div>
                        </div>
                        <div class="terminal-font text-xs bg-yellow-400/20 text-yellow-400 px-2 py-1 rounded">
                            HOT
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="investInProject('PROJECT_CRYPTO_DEFI', '20.00')" class="bg-yellow-400 text-black px-4 py-2 rounded terminal-font text-sm font-bold hover:bg-yellow-300 transition-colors">
                            INVEST_NOW
                        </button>
                        <button class="bg-cyan-400/20 text-cyan-400 border border-cyan-400/30 px-4 py-2 rounded terminal-font text-sm hover:bg-cyan-400/30 transition-colors">
                            VIEW_DETAILS
                        </button>
                    </div>
                </div>
                <div class="holo-effect rounded-lg p-6 border-l-4 border-green-400 mb-4">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold neon-text mb-2">[VERIFIED] NFT MARKETPLACE</h3>
                            <div class="terminal-font text-sm text-green-400/70">
                                Target: 15.00 ETH • Progress: 23% • Time Left: 22 days
                            </div>
                        </div>
                        <div class="terminal-font text-xs bg-green-400/20 text-green-400 px-2 py-1 rounded">
                            VERIFIED
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="contributeToProject('PROJECT_NFT_MARKETPLACE', '15.00')" class="bg-green-400 text-black px-4 py-2 rounded terminal-font text-sm font-bold hover:bg-green-300 transition-colors">
                            CONTRIBUTE_SECRETLY
                        </button>
                        <button class="bg-cyan-400/20 text-cyan-400 border border-cyan-400/30 px-4 py-2 rounded terminal-font text-sm hover:bg-cyan-400/30 transition-colors">
                            ANALYZE_PROJECT
                        </button>
                    </div>
                </div>
            `;
            showMessage('Scanning active projects...', 'info');
        }

        function emergencyProtocols() {
            if (!userAccount) {
                showMessage('Please connect your wallet first.', 'error');
                return;
            }
            
            const campaignsList = document.getElementById('campaignsList');
            campaignsList.innerHTML = `
                <div class="holo-effect rounded-lg p-6 border-l-4 border-red-400">
                    <div class="flex items-center space-x-3 mb-4">
                        <span class="text-3xl">🚨</span>
                        <h3 class="text-xl font-bold text-red-400">EMERGENCY PROTOCOLS ACTIVE</h3>
                    </div>
                    <div class="terminal-font text-sm text-green-400/70 mb-6">
                        [CLASSIFIED] Emergency withdrawal and security protocols are now available.<br/>
                        Use only in case of suspected compromise or urgent fund recovery.
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button class="bg-red-400 text-white px-4 py-3 rounded terminal-font text-sm font-bold hover:bg-red-300 transition-colors">
                            EMERGENCY_WITHDRAWAL
                        </button>
                        <button class="bg-orange-400 text-white px-4 py-3 rounded terminal-font text-sm font-bold hover:bg-orange-300 transition-colors">
                            PAUSE_ALL_CAMPAIGNS
                        </button>
                        <button class="bg-yellow-600 text-white px-4 py-3 rounded terminal-font text-sm font-bold hover:bg-yellow-500 transition-colors">
                            FREEZE_ASSETS
                        </button>
                        <button class="bg-purple-600 text-white px-4 py-3 rounded terminal-font text-sm font-bold hover:bg-purple-500 transition-colors">
                            CONTACT_SUPPORT
                        </button>
                    </div>
                </div>
            `;
            showMessage('Emergency protocols activated. Use with caution.', 'error');
        }

        // Investment and contribution functions
        async function investInProject(projectId, targetAmount) {
            if (!userAccount) {
                showMessage('Please connect your wallet first.', 'error');
                return;
            }

            // Show investment modal
            const amount = prompt(`Enter investment amount (ETH) for ${projectId}:\n\nProject Target: ${targetAmount} ETH\nMinimum: 0.01 ETH`);
            
            if (!amount || parseFloat(amount) <= 0) {
                showMessage('Invalid investment amount.', 'error');
                return;
            }

            try {
                showMessage(`Processing investment of ${amount} ETH... Please confirm in MetaMask.`, 'info');
                
                // Convert amount to Wei
                const amountWei = web3.utils.toWei(amount.toString(), 'ether');
                
                // Create transaction
                const transactionParams = {
                    to: CONTRACT_ADDRESS || '0x4567890123456789012345678901234567890123', // Use placeholder if not set
                    from: userAccount,
                    value: amountWei,
                    data: web3.eth.abi.encodeFunctionCall({
                        name: 'contribute',
                        type: 'function',
                        inputs: [{
                            type: 'bytes32',
                            name: 'projectId'
                        }]
                    }, [web3.utils.keccak256(projectId)])
                };

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transactionParams],
                });

                showMessage(`✅ Investment transaction submitted! TX: ${txHash.substring(0, 10)}...`, 'success');
                
                // Show transaction link and wait for confirmation
                setTimeout(() => {
                    showMessage(`🎉 Investment of ${amount} ETH confirmed! Your contribution is now encrypted and anonymous.`, 'success');
                    showMessage(`📊 View transaction: https://sepolia.etherscan.io/tx/${txHash}`, 'info');
                }, 5000);
                
            } catch (error) {
                console.error('Investment error:', error);
                if (error.code === 4001) {
                    showMessage('Investment cancelled by user.', 'error');
                } else {
                    showMessage('Investment failed: ' + error.message, 'error');
                }
            }
        }

        async function contributeToProject(projectId, targetAmount) {
            if (!userAccount) {
                showMessage('Please connect your wallet first.', 'error');
                return;
            }

            // Show contribution modal with more options
            const amount = prompt(`Secret Contribution to ${projectId}:\n\nProject Target: ${targetAmount} ETH\nYour contribution will be fully encrypted and anonymous.\n\nEnter amount (ETH):`);
            
            if (!amount || parseFloat(amount) <= 0) {
                showMessage('Invalid contribution amount.', 'error');
                return;
            }

            try {
                showMessage(`🔐 Encrypting contribution of ${amount} ETH... Please confirm in MetaMask.`, 'info');
                
                // Convert amount to Wei
                const amountWei = web3.utils.toWei(amount.toString(), 'ether');
                
                // Create encrypted contribution transaction
                const transactionParams = {
                    to: CONTRACT_ADDRESS || '0x4567890123456789012345678901234567890123', // Use placeholder if not set
                    from: userAccount,
                    value: amountWei,
                    data: web3.eth.abi.encodeFunctionCall({
                        name: 'contributeSecretly',
                        type: 'function',
                        inputs: [
                            { type: 'bytes32', name: 'projectId' },
                            { type: 'bytes', name: 'encryptedAmount' }
                        ]
                    }, [
                        web3.utils.keccak256(projectId),
                        web3.utils.toHex(`encrypted_${amount}_${Date.now()}`) // Simulated encrypted data
                    ])
                };

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transactionParams],
                });

                showMessage(`✅ Secret contribution submitted! TX: ${txHash.substring(0, 10)}...`, 'success');
                
                // Simulate confirmation
                setTimeout(() => {
                    showMessage(`🕵️ Secret contribution of ${amount} ETH confirmed! Your identity and amount are fully encrypted using FHE.`, 'success');
                    showMessage(`📊 View transaction: https://sepolia.etherscan.io/tx/${txHash}`, 'info');
                }, 5000);
                
            } catch (error) {
                console.error('Contribution error:', error);
                if (error.code === 4001) {
                    showMessage('Secret contribution cancelled by user.', 'error');
                } else {
                    showMessage('Secret contribution failed: ' + error.message, 'error');
                }
            }
        }

        // Update system stats periodically
        setInterval(() => {
            document.getElementById('activeCampaigns').textContent = Math.floor(Math.random() * 10) + 1;
        }, 5000);
    </script>
</body>
</html>